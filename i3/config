#----------------------------------------------------------------#
# 1. BASIC SETUP & VARIABLES
#----------------------------------------------------------------#

# Set the modifier key to the Super/Windows key.
# Use Mod1 for the Alt key.
set $mod Mod4

# Set preferred applications
set $terminal alacritty
set $launcher "rofi -show drun"

#----------------------------------------------------------------#
# 2. AESTHETICS (FONTS, GAPS, BORDERS)
#----------------------------------------------------------------#

# Set the font for window titles.
# pango: allows for more advanced font rendering and icons.
font pango:JetBrainsMono Nerd Font 11

# Set gaps between windows
gaps inner 6
gaps outer 6

# Enable smart gaps (gaps are removed when there's only one window)
smart_gaps off

# Set window border style
default_border pixel 2
default_floating_border pixel 2

# Hide borders on windows that don't need them
hide_edge_borders smart

#----------------------------------------------------------------#
# 3. THEME (CATPPUCCIN MOCHA)
#----------------------------------------------------------------#

# Window border colors
#                   border  background text    indicator child_border
set $bg-color       #1e1e2e
set $inactive-text  #6c7086
set $inactive-bg    #313244
set $active-text    #cdd6f4
set $active-bg      #1e1e2e
set $urgent-bg      #f38ba8
set $focused-border #cba6f7
set $unfocused-border #45475a

# --- Window Colors ---
# class                 border        background    text          indicator     child_border
client.focused          $focused-border $active-bg    $active-text  $focused-border $focused-border
client.unfocused        $unfocused-border $inactive-bg  $inactive-text $unfocused-border $unfocused-border
client.focused_inactive $unfocused-border $inactive-bg  $inactive-text $unfocused-border $unfocused-border
client.urgent           $urgent-bg      $urgent-bg    $active-text  $urgent-bg      $urgent-bg

#----------------------------------------------------------------#
# 4. KEYBINDINGS
#----------------------------------------------------------------#

# --- Application Shortcuts ---
# Launch a terminal
bindsym $mod+Return exec $terminal

# Kill a focused window
bindsym $mod+Shift+q kill

# --- Window Navigation ---
# Change focus (like Alt+Tab)
bindsym $mod+j focus down
bindsym $mod+k focus up
bindsym $mod+l focus right
bindsym $mod+h focus left

# Alternatively, you can use arrow keys
bindsym $mod+Left focus left
bindsym $mod+Down focus down
bindsym $mod+Up focus up
bindsym $mod+Right focus right

# --- Moving Windows ---
# Move the focused window
bindsym $mod+Shift+j move down
bindsym $mod+Shift+k move up
bindsym $mod+Shift+l move left
bindsym $mod+Shift+h move right

# Move with arrow keys
bindsym $mod+Shift+Left move left
bindsym $mod+Shift+Down move down
bindsym $mod+Shift+Up move up
bindsym $mod+Shift+Right move right

# --- Layout Control ---
# Split in horizontal orientation
bindsym $mod+b split h 

# Split in vertical orientation
bindsym $mod+v split v

# Enter fullscreen mode for the focused window
bindsym $mod+f fullscreen toggle

# Change container layout (stacked, tabbed, toggle split)
bindsym $mod+s layout stacking
bindsym $mod+w layout tabbed
bindsym $mod+e layout toggle split

# Toggle tiling/floating for a window
bindsym $mod+Shift+space floating toggle

# --- Workspace Navigation ---
set $ws1 "1"
set $ws2 "2"
set $ws3 "3"
set $ws4 "4"
set $ws5 "5"

# Switch to workspace
bindsym $mod+1 workspace number $ws1
bindsym $mod+2 workspace number $ws2
bindsym $mod+3 workspace number $ws3
bindsym $mod+4 workspace number $ws4
bindsym $mod+5 workspace number $ws5

# Move focused container to workspace
bindsym $mod+Shift+1 move container to workspace number $ws1
bindsym $mod+Shift+2 move container to workspace number $ws2
bindsym $mod+Shift+3 move container to workspace number $ws3
bindsym $mod+Shift+4 move container to workspace number $ws4
bindsym $mod+Shift+5 move container to workspace number $ws5

# Rofi Modi Keybindings
bindsym $mod+d exec /home/i3-work/.config/rofi/scripts/launcher.sh
bindsym $mod+x exec ~/.config/rofi/scripts/powermenu.sh

# --- System Control ---
# Reload the i3 configuration file
bindsym $mod+Shift+c reload

# Restart i3 inplace (useful for upgrades)
bindsym $mod+Shift+r restart

# Exit i3 session (logs you out)
bindsym $mod+Shift+e exec "i3-nagbar -t warning -m 'You pressed the exit shortcut. Do you really want to exit i3? This will end your X session.' -B 'Yes, exit i3' 'i3-msg exit'"

# Flameshot Keybindings

# PrintScreen launches the interactive GUI
# -p: saves the image to the default path we configured
# -c: copies the image to the clipboard
bindsym Print exec flameshot gui -p ~/Screenshots -c

# Shift+PrintScreen captures the entire screen without the GUI
bindsym Shift+Print exec flameshot full -p ~/Screenshots -c

# $mod+PrintScreen captures the screen with a 5-second delay
bindsym $mod+Print exec flameshot full -d 5000 -p ~/Screenshots -c

# Toggle Redshift (Night Mode)
bindsym $mod+Shift+n exec --no-startup-id ~/.config/i3/scripts/toggle-redshift.sh

# Enter resize mode
bindsym $mod+r mode "resize"

# Show current song notification
bindsym $mod+m exec --no-startup-id ~/.config/i3/scripts/show-music.sh

#----------------------------------------------------------------#
# 5. AUTOSTART APPLICATIONS
#----------------------------------------------------------------#

# Compositor (for transparency, animations, etc.)
exec_always --no-startup-id picom --config ~/.config/picom/picom.conf

# Status bar (we will create this script in the next step)
exec_always --no-startup-id ~/.config/polybar/launch.sh

# Notification daemon
exec_always --no-startup-id dunst

# Network Manager Applet (for managing Wi-Fi, etc.)
exec_always --no-startup-id nm-applet

# Set your wallpaper (install 'feh' first: sudo pacman -S feh)
# Replace with the actual path to your wallpaper.
exec_always --no-startup-id feh --bg-scale ~/Pictures/lost-in-space.png

# Launch the notifier for Caps/Num lock status
exec_always --no-startup-id ~/.config/i3/scripts/lock-key-notifier.sh

# Set GTK Icons and themes
exec --no-startup-id gsettings set org.gnome.desktop.interface icon-theme 'Papirus-Dark'

# ---------------------------------------------------------------- #
# MEDIA KEYS (using pamixer for safe volume control)
# ---------------------------------------------------------------- #
# Increase volume and send notification
bindsym XF86AudioRaiseVolume exec --no-startup-id pamixer -i 5 && ~/.config/i3/scripts/volume-notification.sh

# Decrease volume and send notification
bindsym XF86AudioLowerVolume exec --no-startup-id pamixer -d 5 && ~/.config/i3/scripts/volume-notification.sh

# Mute/unmute volume and send notification
bindsym XF86AudioMute exec --no-startup-id pamixer -t && ~/.config/i3/scripts/volume-notification.sh

# Brightness control
bindsym XF86MonBrightnessUp exec --no-startup-id brightnessctl set 5%+ && ~/.config/i3/scripts/brightness-notification.sh
bindsym XF86MonBrightnessDown exec --no-startup-id brightnessctl set 5%- && ~/.config/i3/scripts/brightness-notification.sh

# Media player controls
bindsym XF86AudioPlay exec --no-startup-id playerctl play-pause
bindsym XF86AudioNext exec --no-startup-id playerctl next
bindsym XF86AudioPrev exec --no-startup-id playerctl previous
bindsym XF86AudioStop exec --no-startup-id playerctl stop

# ================================================================ #
# RESIZE MODE
#
# This mode is entered by pressing $mod+r.
# ================================================================ #
mode "resize" {
    # --- Resize with Vim keys ---
    bindsym h resize shrink width 10 px or 10 ppt
    bindsym j resize grow height 10 px or 10 ppt
    bindsym k resize shrink height 10 px or 10 ppt
    bindsym l resize grow width 10 px or 10 ppt

    # --- Resize with Arrow keys ---
    bindsym Left resize shrink width 10 px or 10 ppt
    bindsym Down resize grow height 10 px or 10 ppt
    bindsym Up resize shrink height 10 px or 10 ppt
    bindsym Right resize grow width 10 px or 10 ppt

    # --- Exit resize mode ---
    # Back to our custom "tiling" mode (without extra quotes)
    bindsym Return mode "default"
    bindsym Escape mode "default"
    bindsym $mod+r mode "default"
}
